<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Mission Control - Live Coaching</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .coaching-container {
            display: flex;
            height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            gap: 20px;
            padding: 20px;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .client-profile {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .client-avatar-large {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 2rem;
            margin: 0 auto 15px;
        }

        .client-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .client-role-large {
            color: #666;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .method-display {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .session-info {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .session-timer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .session-status {
            background: #d4edda;
            color: #155724;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .session-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }

        .meta-item {
            color: #666;
        }

        .meta-value {
            font-weight: 600;
            color: #2c3e50;
        }

        /* Method Tools */
        .method-tools {
            margin-bottom: 25px;
        }

        .tools-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tool-btn {
            width: 100%;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            padding: 12px 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
            color: #2c3e50;
        }

        .tool-btn:hover {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .tool-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        /* Live Notes */
        .live-notes {
            margin-bottom: 25px;
        }

        .notes-textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.9rem;
            resize: vertical;
            background: rgba(255, 255, 255, 0.9);
            transition: border-color 0.3s ease;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Main Chat Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .chat-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 15px;
            animation: slideIn 0.3s ease;
        }

        .message.coach {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .avatar-client {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .avatar-coach {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .avatar-ai {
            background: linear-gradient(135deg, #ffc107, #ff8c00);
        }

        .message-content {
            flex: 1;
            background: #f8f9ff;
            padding: 15px 20px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            position: relative;
        }

        .message.coach .message-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 5px;
        }

        .message.ai .message-content {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #ffc107;
        }

        .message-sender {
            font-weight: 600;
            font-size: 0.8rem;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .message-text {
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.6;
            margin-top: 8px;
        }

        /* Chat Input */
        .chat-input {
            padding: 25px 30px;
            border-top: 1px solid #eee;
            background: rgba(248, 249, 255, 0.8);
        }

        .input-container {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            min-height: 45px;
            max-height: 120px;
            padding: 12px 20px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            background: white;
            transition: all 0.3s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            width: 50px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* AI Assistant Panel */
        .ai-panel {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .ai-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #856404;
            margin-bottom: 15px;
        }

        .ai-suggestions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ai-suggestion {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .ai-suggestion:hover {
            background: white;
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(255, 193, 7, 0.2);
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .coaching-container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .main-area {
                order: 1;
                min-height: 60vh;
            }
        }

        @media (max-width: 768px) {
            .coaching-container {
                padding: 10px;
            }

            .chat-header {
                padding: 15px 20px;
            }

            .chat-messages {
                padding: 20px;
            }

            .chat-input {
                padding: 20px;
            }

            .message-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>
</head>
<body>
    <div class="coaching-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Client Profile -->
            <div class="client-profile">
                <div class="client-avatar-large" id="clientAvatarLarge">SW</div>
                <div class="client-name" id="clientNameLarge">Sarah Weber</div>
                <div class="client-role-large" id="clientRoleLarge">Marketing Managerin</div>
                <div class="method-display" id="methodDisplay">üéØ L√∂sungsorientiertes Coaching</div>
            </div>

            <!-- Session Info -->
            <div class="session-info">
                <div class="session-timer">
                    <span class="timer-display" id="sessionTimer">00:00</span>
                    <span class="session-status">Live Session</span>
                </div>
                <div class="session-meta">
                    <div class="meta-item">
                        <div style="font-size: 0.8rem; color: #999;">Session #</div>
                        <div class="meta-value" id="sessionNumber">4</div>
                    </div>
                    <div class="meta-item">
                        <div style="font-size: 0.8rem; color: #999;">Methode</div>
                        <div class="meta-value" id="methodShort">L√∂sungsorientiert</div>
                    </div>
                </div>
            </div>

            <!-- Method-Specific Tools -->
            <div class="method-tools">
                <div class="tools-title">
                    <span id="toolsIcon">üéØ</span>
                    <span id="toolsTitle">Coaching-Tools</span>
                </div>
                <div id="methodToolsContainer">
                    <!-- Tools will be loaded dynamically -->
                </div>
            </div>

            <!-- Live Notes -->
            <div class="live-notes">
                <div class="tools-title">
                    <span>üìù</span>
                    <span>Live-Notizen</span>
                </div>
                <textarea class="notes-textarea" 
                         placeholder="Notizen w√§hrend der Session..."
                         id="liveNotes"></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn btn-primary" onclick="saveSession()">
                    üíæ Session speichern
                </button>
                <a href="/app" class="action-btn btn-secondary">
                    ‚Üê Zur√ºck zur √úbersicht
                </a>
                <button class="action-btn btn-danger" onclick="endSession()">
                    üîö Session beenden
                </button>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-area">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-title" id="chatTitle">Live Coaching Session</div>
                <div class="chat-controls">
                    <button class="control-btn" onclick="toggleAI()">
                        <span id="aiToggleText">ü§ñ KI ein</span>
                    </button>
                    <button class="control-btn" onclick="exportSession()">
                        üìÑ Export
                    </button>
                </div>
            </div>

            <!-- AI Assistant Panel -->
            <div class="ai-panel" id="aiPanel" style="display: none;">
                <div class="ai-title">
                    ü§ñ KI-Assistent Vorschl√§ge
                </div>
                <div class="ai-suggestions" id="aiSuggestions">
                    <!-- AI suggestions will be loaded here -->
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                <div class="message client">
                    <div class="message-avatar avatar-client">SW</div>
                    <div class="message-content">
                        <div class="message-sender">Sarah Weber</div>
                        <div class="message-text">Hallo! Ich freue mich auf unsere heutige Session. Ich hatte diese Woche wieder viel Stress im Marketing-Team und w√ºrde gerne dar√ºber sprechen.</div>
                        <div class="message-time">vor 2 Minuten</div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input">
                <div class="input-container">
                    <textarea class="message-input" 
                             placeholder="Ihre Antwort eingeben... (Strg+Enter zum Senden)"
                             id="messageInput"
                             rows="1"></textarea>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentClient = null;
        let currentMethod = 'solution-focused';
        let sessionStartTime = Date.now();
        let timerInterval = null;
        let aiEnabled = false;
        let sessionMessages = [];

        // Method configurations
        const methodConfigs = {
            'solution-focused': {
                name: 'L√∂sungsorientiertes Coaching',
                icon: 'üéØ',
                short: 'L√∂sungsorientiert',
                tools: [
                    { name: 'Wunderfrage', prompt: 'Stellen Sie die Wunderfrage: "Angenommen, √ºber Nacht geschieht ein Wunder..."' },
                    { name: 'Skalierungsfrage', prompt: 'Verwenden Sie eine Skalierung von 1-10 f√ºr das Problem' },
                    { name: 'Ausnahmefrage', prompt: 'Fragen Sie nach Zeiten, wo das Problem nicht da war' },
                    { name: 'Ressourcenfrage', prompt: 'Erforschen Sie vorhandene St√§rken und Ressourcen' },
                    { name: 'Zielfrage', prompt: 'Konkretisieren Sie das gew√ºnschte Ziel' }
                ]
            },
            'systemic': {
                name: 'Systemisches Coaching',
                icon: 'üîÑ',
                short: 'Systemisch',
                tools: [
                    { name: 'Zirkul√§re Fragen', prompt: 'Stellen Sie zirkul√§re Fragen: "Was w√ºrde X √ºber Y sagen?"' },
                    { name: 'Systemaufstellung', prompt: 'Erkunden Sie die Systemdynamik und Beziehungen' },
                    { name: 'Perspektivwechsel', prompt: 'Betrachten Sie die Situation aus verschiedenen Blickwinkeln' },
                    { name: 'Musteranalyse', prompt: 'Identifizieren Sie wiederkehrende Muster im System' },
                    { name: 'Hypothesenbildung', prompt: 'Entwickeln Sie Hypothesen √ºber Systemdynamiken' }
                ]
            },
            'values-meaning': {
                name: 'Werte- & Sinnorientiertes Coaching',
                icon: 'üåü',
                short: 'Werteorientiert',
                tools: [
                    { name: 'Werteexploration', prompt: 'Erforschen Sie die Kernwerte der Person' },
                    { name: 'Sinnfrage', prompt: 'Fragen Sie nach dem tieferen Sinn und Zweck' },
                    { name: 'Biografische Arbeit', prompt: 'Betrachten Sie pr√§gende Lebenserfahrungen' },
                    { name: 'Visionsentwicklung', prompt: 'Entwickeln Sie eine sinnhafte Zukunftsvision' },
                    { name: 'Wertekonflikt', prompt: 'Identifizieren Sie m√∂gliche Wertekonflikte' }
                ]
            },
            'gestalt': {
                name: 'Gestalt- & Erlebnisorientiertes Coaching',
                icon: 'üé≠',
                short: 'Gestalt',
                tools: [
                    { name: 'Hier und Jetzt', prompt: 'Fokussieren Sie auf das gegenw√§rtige Erleben' },
                    { name: 'K√∂rperwahrnehmung', prompt: 'Erfragen Sie k√∂rperliche Empfindungen und Signale' },
                    { name: 'Leerer Stuhl', prompt: 'Nutzen Sie die Technik des leeren Stuhls f√ºr Dialoge' },
                    { name: 'Polarit√§ten', prompt: 'Erforschen Sie gegens√§tzliche Anteile der Pers√∂nlichkeit' },
                    { name: 'Kontakt und R√ºckzug', prompt: 'Beobachten Sie Kontakt- und R√ºckzugsmuster' }
                ]
            },
            'triadic-ai': {
                name: 'Triadisches KI-Coaching',
                icon: 'ü§ñ',
                short: 'KI-Coaching',
                tools: [
                    { name: 'Wahrnehmung sch√§rfen', prompt: 'Nutzen Sie die Geissler-Methodik f√ºr Wahrnehmungsschulung' },
                    { name: 'Reflektion f√∂rdern', prompt: 'Leiten Sie systematische Selbstreflexion an' },
                    { name: 'KI-Triade', prompt: 'Beziehen Sie KI als dritten Partner in den Dialog ein' },
                    { name: 'Muster erkennen', prompt: 'Identifizieren Sie mit KI-Hilfe wiederkehrende Muster' },
                    { name: 'Interventionen', prompt: 'Entwickeln Sie gezielte Interventionsstrategien' }
                ]
            },
            'resource-oriented': {
                name: 'Ressourcenorientiertes Coaching',
                icon: 'üíé',
                short: 'Ressourcenorientiert',
                tools: [
                    { name: 'St√§rkenanalyse', prompt: 'Identifizieren Sie vorhandene St√§rken und Talente' },
                    { name: 'Erfolgsgeschichten', prompt: 'Erforschen Sie vergangene Erfolge und Bew√§ltigungsstrategien' },
                    { name: 'Support-System', prompt: 'Kartieren Sie das pers√∂nliche Unterst√ºtzungsnetzwerk' },
                    { name: 'Positive Psychologie', prompt: 'Fokussieren Sie auf positive Emotionen und Erfahrungen' },
                    { name: 'Ressourcenaktivierung', prompt: 'Aktivieren Sie schlummernde Potentiale' }
                ]
            }
        };

        // Demo clients data
        const demoClients = {
            'demo-1': { name: 'Sarah Weber', role: 'Marketing Managerin', avatar: 'SW' },
            'demo-2': { name: 'Michael Keller', role: 'IT-Leiter', avatar: 'MK' },
            'demo-3': { name: 'Anna Zimmermann', role: 'Projektmanagerin', avatar: 'AZ' },
            'demo-4': { name: 'Thomas Meier', role: 'Gesch√§ftsf√ºhrer', avatar: 'TM' },
            'demo-5': { name: 'Lisa M√ºller', role: 'Vertriebsleiterin', avatar: 'LM' }
        };

        function loadClientFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('client');
            
            if (clientId && demoClients[clientId]) {
                currentClient = demoClients[clientId];
                updateClientDisplay();
            }
        }

        function loadMethodFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const method = urlParams.get('method');
            
            if (method && methodConfigs[method]) {
                currentMethod = method;
                updateMethodDisplay();
                loadMethodTools();
            }
        }

        function updateClientDisplay() {
            if (!currentClient) return;
            
            document.getElementById('clientAvatarLarge').textContent = currentClient.avatar;
            document.getElementById('clientNameLarge').textContent = currentClient.name;
            document.getElementById('clientRoleLarge').textContent = currentClient.role;
            document.getElementById('chatTitle').textContent = `Live Session - ${currentClient.name}`;
        }

        function updateMethodDisplay() {
            const config = methodConfigs[currentMethod];
            document.getElementById('methodDisplay').innerHTML = `${config.icon} ${config.name}`;
            document.getElementById('methodShort').textContent = config.short;
            document.getElementById('toolsIcon').textContent = config.icon;
            document.getElementById('toolsTitle').textContent = config.name + ' Tools';
        }

        function loadMethodTools() {
            const config = methodConfigs[currentMethod];
            const container = document.getElementById('methodToolsContainer');
            
            container.innerHTML = config.tools.map(tool => `
                <button class="tool-btn" onclick="useTool('${tool.prompt}')">
                    ${tool.name}
                </button>
            `).join('');
        }

        function useTool(prompt) {
            // Add AI suggestion based on tool
            if (aiEnabled) {
                addAISuggestion(prompt);
            } else {
                // Insert prompt into message input
                document.getElementById('messageInput').value = prompt;
                document.getElementById('messageInput').focus();
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('sessionTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function toggleAI() {
            aiEnabled = !aiEnabled;
            const panel = document.getElementById('aiPanel');
            const toggleText = document.getElementById('aiToggleText');
            
            if (aiEnabled) {
                panel.style.display = 'block';
                toggleText.textContent = 'ü§ñ KI aus';
                loadAISuggestions();
            } else {
                panel.style.display = 'none';
                toggleText.textContent = 'ü§ñ KI ein';
            }
        }

        function loadAISuggestions() {
            const config = methodConfigs[currentMethod];
            const suggestions = [
                `Basierend auf ${config.name}: Wie k√∂nnten Sie das Gespr√§ch vertiefen?`,
                `${config.icon} Methodenvorschlag: Nutzen Sie eine spezifische Technik`,
                `Reflexionsfrage: Was w√ºrde Ihrer Einsch√§tzung nach hier weiterhelfen?`
            ];
            
            const container = document.getElementById('aiSuggestions');
            container.innerHTML = suggestions.map(suggestion => `
                <div class="ai-suggestion" onclick="useAISuggestion('${suggestion}')">
                    ${suggestion}
                </div>
            `).join('');
        }

        function addAISuggestion(text) {
            const container = document.getElementById('aiSuggestions');
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'ai-suggestion';
            suggestionDiv.textContent = text;
            suggestionDiv.onclick = () => useAISuggestion(text);
            container.appendChild(suggestionDiv);
        }

        function useAISuggestion(suggestion) {
            document.getElementById('messageInput').value = suggestion;
            document.getElementById('messageInput').focus();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add coach message
            addMessage('coach', 'Coach', message);
            input.value = '';
            
            // Auto-resize textarea
            input.style.height = 'auto';
            
            // Simulate client response after delay
            setTimeout(() => {
                simulateClientResponse(message);
            }, 1500 + Math.random() * 2000);
        }

        function addMessage(type, sender, text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatarClass = type === 'coach' ? 'avatar-coach' : 
                              type === 'ai' ? 'avatar-ai' : 'avatar-client';
            const avatar = type === 'coach' ? 'C' : 
                          type === 'ai' ? 'AI' : (currentClient ? currentClient.avatar : 'K');
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${avatarClass}">${avatar}</div>
                <div class="message-content">
                    <div class="message-sender">${sender}</div>
                    <div class="message-text">${text}</div>
                    <div class="message-time">${new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'})}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Store message
            sessionMessages.push({ type, sender, text, timestamp: Date.now() });
        }

        function simulateClientResponse(coachMessage) {
            const responses = [
                "Das ist ein interessanter Punkt. Ich denke, das k√∂nnte mir wirklich helfen.",
                "Ja, das macht Sinn. Ich merke, dass ich das anders betrachten kann.",
                "Hmm, dar√ºber habe ich noch nicht so gedacht. Das gibt mir neue Perspektiven.",
                "Das trifft genau ins Schwarze. Ich sp√ºre, dass sich etwas in mir bewegt.",
                "Vielen Dank f√ºr diese Frage. Das bringt mich zum Nachdenken."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            const clientName = currentClient ? currentClient.name : 'Klient';
            addMessage('client', clientName, randomResponse);
        }

        function saveSession() {
            const sessionData = {
                client: currentClient,
                method: currentMethod,
                startTime: sessionStartTime,
                duration: Date.now() - sessionStartTime,
                messages: sessionMessages,
                notes: document.getElementById('liveNotes').value
            };
            
            // Simulate save
            alert('Session erfolgreich gespeichert!');
            console.log('Session saved:', sessionData);
        }

        function endSession() {
            if (confirm('M√∂chten Sie die Session wirklich beenden?')) {
                saveSession();
                window.location.href = '/app';
            }
        }

        function exportSession() {
            const sessionData = {
                client: currentClient?.name || 'Unbekannt',
                method: methodConfigs[currentMethod].name,
                date: new Date().toLocaleDateString('de-DE'),
                duration: document.getElementById('sessionTimer').textContent,
                messages: sessionMessages,
                notes: document.getElementById('liveNotes').value
            };
            
            const dataStr = JSON.stringify(sessionData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `session-${currentClient?.name || 'unknown'}-${Date.now()}.json`;
            link.click();
        }

        function initializeKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    sendMessage();
                }
                if (e.key === 'Escape') {
                    if (confirm('Session beenden?')) {
                        endSession();
                    }
                }
            });

            // Auto-resize textarea
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadClientFromURL();
            loadMethodFromURL();
            initializeKeyboardShortcuts();
            startTimer();
            
            // Auto-select first method if none provided
            if (!currentMethod || !methodConfigs[currentMethod]) {
                currentMethod = 'solution-focused';
                updateMethodDisplay();
                loadMethodTools();
            }
        });
    </script>
</body>
</html>